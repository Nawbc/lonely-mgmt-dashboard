var e,t,a=Object.defineProperty,n=Object.prototype.hasOwnProperty,l=Object.getOwnPropertySymbols,r=Object.prototype.propertyIsEnumerable,s=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,i=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&s(e,a,t[a]);return e};import{C as o,a as c,m as d,b as u,u as m,c as p,T as h,M as y,B as g,P as E,W as f,d as b,e as v,f as w,g as k,h as x,i as C,S as T,j as I,k as S,l as z,n as _,R,o as N,I as P,p as q,q as F,r as U,D as A,F as O,s as V,t as B,v as L,w as X,A as j,x as D,y as G,z as J,E as $,U as H,G as M,H as K,Q as Z,J as Q,K as W,L as Y}from"./vendor.336a4ffa.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,r)=>{const s=new URL(e,n);if(self[t].moduleMap[s])return a(self[t].moduleMap[s]);const i=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(i),onerror(){r(new Error(`Failed to import: ${e}`)),l(o)},onload(){a(self[t].moduleMap[s]),l(o)}});document.head.appendChild(o)})),self[t].moduleMap={}}}("/assets/");const ee=o.create({timeout:8e3,baseURL:"https://lonely-mgmt-demo.deskbtm.com"});ee.interceptors.request.use((function(e){console.log("request....",e);const t=localStorage.getItem("t");return e.headers.Authorization=`Bearer ${t}`,e}),(function(e){return Promise.resolve(e)})),ee.interceptors.response.use((function(e){const t=e.data;return t.code<=0&&t.message&&c.error(t.message),e}),(function(e){if(e.response){const t=e.response.data;console.error(e.response),t.message&&c.error(t.message),401===t.statusCode&&(localStorage.removeItem("t"),setTimeout((()=>{location.reload()}),1e3))}else c.error("无响应");return Promise.resolve(e.response)}));const te=o.create({timeout:8e3,baseURL:"https://lonely-mgmt-demo.deskbtm.com"});te.interceptors.request.use((function(e){console.log("request client....",e),e.data?e.data.packageName="com.deskbtm.lonely":e.data={packageName:"com.deskbtm.lonely"};const t=localStorage.getItem("client_auth");return e.headers.Authorization=`Bearer ${t}`,e}),(function(e){return Promise.resolve(e)})),te.interceptors.response.use((function(e){const t=e.data;return t.code<=0&&t.message&&c.error(t.message),e}),(function(e){if(e.response){const t=e.response.data;console.log(e.response),t.message&&c.error(t.message),401===t.statusCode&&(localStorage.removeItem("t"),setTimeout((()=>{location.reload()}),1e3))}else c.error("无响应");return Promise.resolve(e.response)}));const ae=async function(){return ee.post("/v1/dashboard/admin/login_jwt")},ne=async function(){return ee.post("/v1/goods/query")};const le=new class{constructor(){this.user={},d(this)}setUser(e){this.user=e}},re=u.createContext(le);const se=function(e){!function(){const e=m(),t=p();u.useEffect((()=>{localStorage.getItem("t")||e.replace("/login")}),[t.pathname])}();const t=m(),a=u.useContext(re),[n,l]=u.useState(!1);return u.useEffect((()=>{!async function(){if(!localStorage.getItem("t"))return l(!0),void t.replace("/login");const{data:e}=await ae();l(!0),e.code>0?(e.data&&a.setUser(e.data),"/"===t.location.pathname.trim()&&t.replace("/dash")):t.replace("/login")}()}),[]),n?e.children:null},ie=function(e){const{width:t,content:a}=e;return u.createElement(h,{title:a},u.createElement("div",{style:{textOverflow:"ellipsis",whiteSpace:"nowrap",width:t,overflow:"hidden"}},a))},oe={type:(e,t)=>Object.prototype.toString.call(e)===`[object ${t}]`,string(e){return this.type(e,"String")},object(e){return this.type(e,"Object")},function(e){return this.type(e,"Function")},asyncFunction(e){return this.type(e,"AsyncFunction")},null(e){return this.type(e,"Null")},undefined(e){return this.type(e,"Undefined")},number(e){return this.type(e,"Number")},array(e){return this.type(e,"Array")}},ce={uri:/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\*\+,;=.]+$/,androidPackage:/^([A-Za-z]{1}[A-Za-z\d_]*\.)+[A-Za-z][A-Za-z\d_]*$/,email:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,space:/^[^\s]*$/},de=function(e){var t,a,n,l,r,s,i,o,c,d,m,p,h,v,w,k;const x=u.useRef();return u.createElement(y,{title:e.title,trigger:u.createElement(g,{type:"primary",size:e.size},e.title),onFinish:e.onFinish,onVisibleChange:e=>{var t;e&&(null==(t=x.current)||t.resetFields())},formRef:x},u.createElement(E.Group,null,u.createElement(f,{width:"md",name:"goodsName",label:"商品名称",placeholder:"请输入商品名称",initialValue:null!=(a=null==(t=e.row)?void 0:t.goodsName)?a:"",rules:[{required:!0,message:"请输入"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(f,{width:"md",name:"packageName",label:"软件包名",placeholder:"请输入软件包名",initialValue:null!=(l=null==(n=e.row)?void 0:n.packageName)?l:"",rules:[{required:!0,message:"请输入"},{pattern:ce.androidPackage,message:"不合法的软件包名!"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(b,{width:"md",name:"price",label:"价格",placeholder:"请输入价格",min:.01,initialValue:null!=(s=null==(r=e.row)?void 0:r.price)?s:"",rules:[{required:!0,message:"请输入"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(b,{width:"md",name:"discount",label:"折扣价格(选填)",min:0,initialValue:null!=(o=null==(i=e.row)?void 0:i.discount)?o:0}),u.createElement(f,{width:"md",name:"alipayCallback",label:"支付宝回调url",initialValue:null!=(d=null==(c=e.row)?void 0:c.alipayCallback)?d:"",placeholder:"输入支付宝回调",rules:[{required:!0,message:"请输入"},{pattern:ce.uri,message:"请输入合法回调"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(f,{width:"md",name:"shareUrl",label:"分享跳转链接",initialValue:null!=(p=null==(m=e.row)?void 0:m.shareUrl)?p:"",rules:[{pattern:ce.uri,message:"请输入合法链接"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(f,{width:"md",name:"alipayGateway",label:"支付宝网关url",initialValue:null!=(v=null==(h=e.row)?void 0:h.alipayGateway)?v:"",rules:[{required:!0,message:"请输入"},{pattern:ce.uri,message:"请输入合法回调"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(f,{width:"md",name:"alipayDesc",initialValue:null!=(k=null==(w=e.row)?void 0:w.alipayDesc)?k:"",label:"支付描述",placeholder:"用户跳转支付时的提示",rules:[{required:!0,message:"请输入"}]})))},ue=[{title:"应用名称",dataIndex:"goodsName",copyable:!0,width:100,ellipsis:!0,fixed:"left"},{title:"包名",dataIndex:"packageName",copyable:!0,width:100,ellipsis:!0},{title:"价格",dataIndex:"price",width:80},{title:"折扣价格",dataIndex:"discount",width:80},{title:"创建者",width:120,ellipsis:!0,dataIndex:"createBy",render:(e,t)=>u.createElement("span",null,t.createBy.username)},{title:"支付宝回调url",dataIndex:"alipayCallback",width:150,ellipsis:!0,copyable:!0},{title:"支付宝网关url",dataIndex:"alipayGateway",width:150,ellipsis:!0,copyable:!0},{title:"分享跳转url",dataIndex:"shareUrl",width:150,ellipsis:!0,copyable:!0},{title:"禁用",dataIndex:"disabled",copyable:!0,width:50,render:(e,t)=>u.createElement("span",{style:{color:t.disabled?"red":"green"}},t.disabled?"是":"否")},{title:"支付描述",dataIndex:"alipayDesc",valueType:"select",width:120,ellipsis:!0},{title:"操作",width:200,key:"option",valueType:"option",fixed:"right",render:(e,t,a,n)=>[u.createElement(de,{row:t,title:"修改",size:"small",onFinish:async e=>{if(e.price<e.discount)return void c.error("折扣价大于价格");const{data:a}=await async function(e){return ee.post("/v1/goods/modify",e)}(Object.assign({},{id:t.id},e));return a.code>0&&(c.success(a.message),n.reload(),!0)}}),u.createElement(k,{title:"你确定修改此应用?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/goods/disable",e)}({id:t.id,disabled:!t.disabled});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0},t.disabled?"解禁":"禁用")),u.createElement(k,{title:"你确定删除此应用?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/goods/delete",e)}({id:t.id});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0},"删除"))]}],me=function(){return u.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column"}},u.createElement("br",null),u.createElement("div",null,"管理员名: demo@demo.com"),u.createElement("div",null,"密码: demo123456"))};const pe=new I,he=function(e){var t;const{row:a}=e,[n,l]=u.useState(!1),r=u.useRef(),s=u.useRef(),o={html:null,text:null},[d,m]=u.useState(o);return u.createElement(y,{title:e.title,formRef:r,trigger:u.createElement(g,{type:"primary",size:e.size},e.title),onVisibleChange:e=>{var t;e?a&&m({html:a.descriptionHtml,text:a.description}):m(o),null==(t=r.current)||t.resetFields()},onFinish:async t=>{if(d.html&&d.text)return n||await e.onFinish(i(i({},t),{id:null==a?void 0:a.id,description:d.text,descriptionHtml:d.html})),!n;c.error("请输入更新内容")}},u.createElement(S,{title:"编辑更新内容",centered:!0,keyboard:!1,visible:n,onOk:()=>l(!1),onCancel:()=>l(!1),width:"90%"},u.createElement(z,{onChange:e=>{m(e)},defaultValue:d.text,style:{height:"500px"},renderHTML:e=>pe.render(e)})),u.createElement(E.Group,null,u.createElement(f,{allowClear:!0,width:"md",name:"title",label:"更新主题",initialValue:null==a?void 0:a.title,rules:[{required:!0,message:"请输入"}]}),!!e.packageName&&u.createElement(f,{width:"md",name:"packageName",label:"软件包名",initialValue:e.packageName,rules:[{required:!0,message:"请输入"},{pattern:ce.androidPackage,message:"不合法的软件包名!"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(f,{width:"md",name:"semver",label:"版本号",disabled:e.disable.includes("semver"),initialValue:null==a?void 0:a.semver,rules:[{required:!0,message:"请输入"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(_,{fieldProps:{defaultChecked:null!=(t=null==a?void 0:a.forceUpdate)&&t},name:"forceUpdate"},"强制更新")),u.createElement(g,{onClick:()=>{l(!0)}},"更新内容"),u.createElement("div",{ref:s,dangerouslySetInnerHTML:{__html:d.html},style:{marginTop:10,backgroundColor:"#ebebeb",width:"50%",height:200,overflow:"hidden"}}))};he.defaultProps={disable:[]};const{TabPane:ye}=N,ge=[{title:"id",dataIndex:"id",hideInTable:!0},{title:"更新标题",dataIndex:"title"},{title:"发布时间",render:(e,t)=>u.createElement(ie,{content:new Date(t.releaseTimestamp).toLocaleString()})},{title:"版本",dataIndex:"semver",width:80},{title:"更新内容",dataIndex:"description",render:(e,t)=>u.createElement(ie,{width:120,content:t.description})},{dataIndex:"descriptionHtml",hideInTable:!0},{title:"强制更新",render:(e,t)=>u.createElement("span",{style:{color:t.forceUpdate?"red":"green"}},t.forceUpdate?"是":"否")},{title:"创建者",dataIndex:"createBy",width:80,render:(e,t)=>{var a;return u.createElement(ie,{width:80,content:null==(a=t.releaseBy)?void 0:a.username})}},{title:"操作",width:"164px",key:"option",valueType:"option",render:(e,t,a,n)=>[u.createElement(k,{title:"你确定修改此应用?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/tools/app_update/force_update",e)}({id:t.id,forceUpdate:!t.forceUpdate});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:t.forceUpdate?"default":"primary"},t.forceUpdate?"取消强制":"强制更新")),u.createElement(he,{title:"修改",size:"small",disable:["semver"],row:t,onFinish:async e=>{const{data:t}=await async function(e){return ee.post("/v1/tools/app_update/modify",e)}(e);return t.code>0&&(c.success(t.message),n.reload(),!0)}})]}],Ee="https://app-mgmt.deskbtm.com",fe=function(e){var t,a,n;const[l,r]=u.useState({}),[s,i]=u.useState(),[o,d]=u.useState(!1);return u.useEffect((()=>{!async function(){const{data:e}=await async function(e){return ee.post("/v1/pay/qrcode_n",e,{baseURL:Ee})}({packageName:"com.deskbtm.lonely"});(null==e?void 0:e.code)>0&&r(e.data)}()}),[o]),u.createElement("div",null,u.createElement(g,{style:{float:"right"},onClick:()=>{d(!o)}},"刷新"),u.createElement("div",{style:{width:400,height:400,display:"flex",flexDirection:"column",alignItems:"center",margin:"0 auto"}},u.createElement("div",null,u.createElement(P,{src:l.qrcode,style:{width:200,height:200}})),u.createElement("h3",null,null==(t=null==l?void 0:l.bizContent)?void 0:t.total_amount,"￥"),u.createElement("br",null),u.createElement("strong",null,"订单号:",null==(n=null==(a=null==l?void 0:l.details)?void 0:a.alipay_trade_precreate_response)?void 0:n.out_trade_no),u.createElement("br",null),u.createElement("span",{style:{fontSize:13}},"支付后点击验证 获取github仓库地址 包含前后端两个仓库"),u.createElement("span",{style:{fontSize:13}},"该支付 不会保存到数据库"),u.createElement("strong",{style:{fontSize:13,color:"red"}},"验证之前 请勿刷新，会导致订单丢失"),u.createElement("br",null),u.createElement(g,{onClick:async()=>{var e,t;let{data:a}=await async function(e){return ee.post("/v1/pay/query_trade",e,{baseURL:Ee})}(null==l?void 0:l.bizContent);"TRADE_SUCCESS"===(null==(t=null==(e=a.data)?void 0:e.alipay_trade_query_response)?void 0:t.trade_status)&&(c.success(a.message),i("https://github.com/sewerganger/lonely-manager"))}},"验证支付")),u.createElement("p",null,"Github仓库地址:"," ",s?u.createElement("a",{href:s},s):"XXXXXXXXXXXXXXXXXXXXXXXXX"),u.createElement(x,{title:"查看接口返回详情",headerBordered:!0,collapsible:!0,defaultCollapsed:!0,onCollapse:e=>console.log(e)},u.createElement("pre",null,u.createElement("code",null,JSON.stringify(l,null,"\t")))))},be=function(e){const[t,a]=u.useState("");return u.createElement(y,{title:e.title,trigger:u.createElement(g,{type:"primary"},e.title)},u.createElement("div",{style:{textAlign:"center"}},u.createElement(g,{onClick:async()=>{const{data:e}=await te.post("/v1/client/user/share_goods_url");e.code>0&&a(new URL(e.data.path,"https://lonely-mgmt-demo.deskbtm.com").href)}},"获取分享链接"),u.createElement("br",null),u.createElement("br",null),u.createElement("a",{href:t,target:"_blank"},t)))},ve=function(){return u.createElement("div",{style:{display:"flex",justifyContent:"center"}},u.createElement(be,{title:"分享任务"}))},we=q.parse(window.navigator.userAgent),ke={os:null==(e=we.os)?void 0:e.name,osVersion:null==(t=we.os)?void 0:t.version,brand:"hp",modelName:"envy13"},xe=function(e){const[t,a]=u.useState(ke);return u.createElement("div",{style:{display:"flex",justifyContent:"center"}},u.createElement(x,{style:{width:350},tabs:{type:"line"}},u.createElement(x.TabPane,{key:"login-tab",tab:"登录"},u.createElement(E,{onFinish:async t=>{const{data:a}=await(n=i({packageName:"com.deskbtm.lonely"},t),ee.post("/v1/client/user/login_pwd",n));var n;a.code>0&&(c.success(a.message),localStorage.setItem("client_auth",a.data.auth),e.onLogin(!0))},submitter:{searchConfig:{submitText:"登录"},render:(e,t)=>t.pop(),submitButtonProps:{size:"large",style:{width:"100%"}}}},u.createElement(f,{fieldProps:{size:"large",prefix:u.createElement(C,null)},name:"username",placeholder:"邮箱",rules:[{required:!0,message:"请输入用户名!"},{pattern:ce.email,message:"不合法的用户名!"}]}),u.createElement("div",{style:{height:10}}),u.createElement(f.Password,{fieldProps:{size:"large",prefix:u.createElement(T,null)},name:"password",placeholder:"密码",rules:[{required:!0,message:"请输入密码"}]}),u.createElement("div",{style:{height:10}}))),u.createElement(x.TabPane,{key:"register-tab",tab:"注册"},u.createElement(E,{onFinish:async e=>{const{data:t}=await(n=i({device:ke,packageName:"com.deskbtm.lonely"},e),ee.post("/v1/client/user/register",n));var n;t.code>0&&(c.success(t.message),a(t.data))},submitter:{searchConfig:{submitText:"注册"},render:(e,t)=>t.pop(),submitButtonProps:{size:"large",style:{width:"100%"}}}},u.createElement(f,{fieldProps:{size:"large",prefix:u.createElement(C,null)},name:"username",placeholder:"邮箱",rules:[{required:!0,message:"请输入用户名!"},{pattern:ce.email,message:"不合法的用户名!"}]}),u.createElement("div",{style:{height:10}}),u.createElement(f.Password,{fieldProps:{size:"large",prefix:u.createElement(T,null)},name:"password",placeholder:"密码",rules:[{required:!0,message:"请输入密码"},{pattern:ce.space,message:"不能含有空格!"}]}),u.createElement(F,{fieldProps:{size:"large",prefix:u.createElement(U,null)},captchaProps:{size:"large"},name:"captcha",phoneName:"username",rules:[{required:!0,message:"请输入验证码"},{pattern:ce.space,message:"不能含有空格!"}],placeholder:"请输入验证码",onGetCaptcha:async e=>{const{data:t}=await(a={username:e},ee.post("/v1/client/user/register_captcha",a));var a;(null==t?void 0:t.code)>0?c.success("验证码发送成功!"):c.error("验证码发送成功!")}}),u.createElement("div",{style:{height:10}})),u.createElement("br",null),u.createElement("span",null,"mock的设备信息 注册需要带上"),u.createElement("pre",null,u.createElement("code",null,JSON.stringify(t,null,"\t"))))))},Ce=function(){const[e,t]=u.useState(!1);return u.createElement("div",{style:{display:"flex",justifyContent:"center"}},e?u.createElement(ve,null):u.createElement(xe,{onLogin:t}))},{TabPane:Te}=N,Ie=function(e){var t;const{row:a}=e,n=u.useRef();return u.createElement(y,{title:e.title,formRef:n,trigger:u.createElement(g,{type:"primary",size:e.size},e.title),onVisibleChange:e=>{var t;e&&(null==(t=n.current)||t.resetFields())},onFinish:async t=>e.onFinish(i(i({},t),{id:null==a?void 0:a.id}))},u.createElement(E.Group,null,u.createElement(_,{fieldProps:{defaultChecked:null!=(t=null==a?void 0:a.purchased)&&t},name:"purchased"},"是否支付")))},Se=[{title:"订单号",dataIndex:"tradeNo",width:150,ellipsis:!0,copyable:!0},{dataIndex:"id",hideInTable:!0,search:!1},{title:"用户名",width:120,copyable:!0,dataIndex:"username",renderText:(e,t)=>t.user.username},{title:"支付宝订单",dataIndex:"alipayTradeNo",width:150,ellipsis:!0,copyable:!0},{title:"支付宝id",dataIndex:"buyerAlipayId",width:80,ellipsis:!0,copyable:!0},{title:"是否支付",dataIndex:"purchased",width:50,search:!1,render:(e,t)=>u.createElement("span",{style:{color:t.purchased?"red":"green"}},t.purchased?"是":"否")},{title:"支付金额",dataIndex:"payAmount",width:80,search:!1},{title:"商品",width:80,render:(e,t)=>u.createElement("span",null,t.goods.goodsName)},{align:"center",title:"操作",width:"164px",key:"option",valueType:"option",render:(e,t,a,n)=>[u.createElement(Ie,{title:"修改",size:"small",row:t,onFinish:async e=>{const{data:t}=await async function(e){return ee.post("/v1/pay/modify",e)}(e);return n.reload(),t.code>0&&(c.success(t.message),!0)}}),u.createElement(k,{title:"你确定删除此订单?",onConfirm:async e=>{const{data:a}=await async function(e){return ee.post("/v1/pay/delete",e)}({id:t.id});return n.reload(),a.code>0&&(c.success(a.message),!0)},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0},"删除")),u.createElement(k,{title:"",onConfirm:async()=>{n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0}))]}],ze=[{title:"用户id",dataIndex:"id",width:100,ellipsis:!0,copyable:!0},{title:"用户名",dataIndex:"username",width:100,copyable:!0,ellipsis:!0},{title:"是否禁用",dataIndex:"forbidden",width:80,search:!1,render:(e,t)=>u.createElement("span",{style:{color:t.forbidden?"red":"green"}},t.forbidden?"是":"否")},{title:"分享任务",dataIndex:"shareTask",width:160,search:!1,render:(e,t)=>(null==t?void 0:t.goods)?t.goods.map(((e,t)=>u.createElement("div",{key:String(t)},u.createElement("span",null,e.packageName),"    ",u.createElement("span",null,e.accomplishShareTask?"是":"否")))):null},{title:"是否关注bilibili",dataIndex:"forbidden",width:80,search:!1,render:(e,t)=>u.createElement("span",{style:{color:t.followedBilibili?"red":"green"}},t.followedBilibili?"是":"否")},{align:"center",title:"操作",width:"164px",key:"option",valueType:"option",render:(e,t,a,n)=>[u.createElement(k,{key:"1",title:"你确定删除此用户?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/dashboard/consumer/delete",e)}({id:t.id});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0},"删除")),u.createElement(k,{key:"2",title:t.forbidden?"你确定解禁此用户?":"你确定禁用此用户?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/dashboard/consumer/forbid",e)}({forbidden:!t.forbidden,id:t.id});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",type:"ghost",danger:!0},t.forbidden?"解禁":"禁用"))]}],_e=()=>{const e=m();return u.createElement(X,null,u.createElement(X.Item,null,u.createElement(g,{type:"text",onClick:()=>{localStorage.clear(),location.reload()}},"退出登录")),u.createElement(X.Item,null,u.createElement(g,{type:"text",onClick:()=>{e.push("/dash/profile")}},"个人设置")))},Re=function(){const e=m();return u.createElement(R,{status:"404",title:"404",subTitle:"页面不存在",extra:u.createElement(g,{type:"primary",onClick:()=>{e.replace("/dash")}},"返回")})},Ne=function(e){return u.createElement(y,{title:e.title,trigger:u.createElement(g,{type:"primary",size:e.size},e.title),onVisibleChange:()=>{},onFinish:async t=>{var a,n;if((null==(a=Object.keys(t.buttons))?void 0:a.length)<=0)return;const l=null==(n=t.buttons)?void 0:n.map((e=>({[e.prop]:e.value})));return await e.onFinish(Object.assign({},...l)),!0}},u.createElement(J,{name:"buttons",initialValue:[],creatorButtonProps:{position:"bottom"}},u.createElement(E.Group,null,u.createElement(f,{name:"prop",label:"属性"}),u.createElement(f,{name:"value",label:"值"}))))},Pe=new I,qe=function(e){var t,a;const{row:n}=e,[l,r]=u.useState(!1),s=u.useRef(),o=u.useRef(),[d,m]=u.useState([]),p=(()=>{const[,e]=u.useReducer((e=>e+1),0);return e})(),h={html:null,text:null},[b,v]=u.useState(h);return u.createElement(y,{title:e.title,formRef:o,trigger:u.createElement(g,{type:"primary",size:e.size},e.title),onVisibleChange:e=>{var t,a;e?n&&(v({html:n.descriptionHtml,text:n.description}),m(null!=(t=n.buttons)?t:[])):(m([]),v(h)),null==(a=o.current)||a.resetFields()},onFinish:async t=>{if(b.html&&b.text)return e.onFinish(i(i({},t),{id:null==n?void 0:n.id,description:b.text,descriptionHtml:b.html,buttons:d}));c.error("请输入通知内容")}},u.createElement(S,{title:"编辑通知内容",centered:!0,keyboard:!1,visible:l,onOk:()=>r(!1),onCancel:()=>r(!1),width:"90%"},u.createElement(z,{onChange:e=>{v(e)},defaultValue:b.text,style:{height:"500px"},renderHTML:e=>Pe.render(e)})),u.createElement(E.Group,null,u.createElement(f,{width:"md",name:"title",label:"标题",initialValue:null==n?void 0:n.title,rules:[{required:!0,message:"请输入"}]}),!!e.packageName&&u.createElement(f,{width:"md",name:"packageName",label:"软件包名",initialValue:e.packageName,rules:[{required:!0,message:"请输入"},{pattern:ce.androidPackage,message:"不合法的软件包名!"},{pattern:ce.space,message:"禁止输入空格"}]}),u.createElement(_,{initialValue:null!=(t=null==n?void 0:n.forceDisplay)&&t,name:"forceDisplay"},"强制显示"),u.createElement(_,{initialValue:null==(a=null==n?void 0:n.display)||a,name:"display"},"显示")),u.createElement(Ne,{title:"添加通知按钮",onFinish:async e=>{d.push(e),m(d),p()}}),u.createElement("br",null),u.createElement("br",null),d.map(((e,t)=>u.createElement($,{key:String(t),closable:!0,onClose:()=>{d.splice(t,1),m(d),p()}},JSON.stringify(e)))),u.createElement("br",null),u.createElement("br",null),u.createElement(g,{onClick:()=>{r(!0)}},"编辑通知内容"),u.createElement("div",{ref:s,dangerouslySetInnerHTML:{__html:b.html},style:{marginTop:10,backgroundColor:"#ebebeb",width:"50%",height:200,overflow:"hidden"}}))};qe.defaultProps={disable:[]};const{TabPane:Fe}=N,Ue=[{title:"id",dataIndex:"id",render:(e,t)=>u.createElement(ie,{width:60,content:t.id})},{title:"更新标题",dataIndex:"title"},{title:"发布时间",render:(e,t)=>u.createElement(ie,{content:new Date(t.releaseTimestamp).toLocaleString()})},{title:"更新内容",dataIndex:"description",render:(e,t)=>u.createElement(ie,{width:120,content:t.description})},{title:"通知按钮",dataIndex:"buttons",render:(e,t)=>u.createElement(ie,{width:120,content:JSON.stringify(t.buttons)})},{dataIndex:"descriptionHtml",hideInTable:!0},{title:"强制显示",render:(e,t)=>u.createElement("span",{style:{color:t.forceDisplay?"red":"green"}},t.forceDisplay?"是":"否")},{title:"显示",render:(e,t)=>u.createElement("span",{style:{color:t.display?"red":"green"}},t.display?"是":"否")},{title:"创建者",dataIndex:"createBy",width:80,render:(e,t)=>{var a;return u.createElement(ie,{width:80,content:null==(a=t.releaseBy)?void 0:a.username})}},{title:"操作",width:"164px",key:"option",valueType:"option",render:(e,t,a,n)=>[u.createElement(qe,{title:"修改",row:t,size:"small",onFinish:async e=>{const{data:t}=await async function(e){return ee.post("/v1/tools/splash_notification/modify",e)}(i({},e));return t.code>0&&(c.success(t.message),n.reload()),!0}}),u.createElement(k,{title:"你确定修改此应用?",onConfirm:async()=>{const{data:e}=await async function(e){return ee.post("/v1/tools/splash_notification/delete",e)}({id:t.id});e.code>0&&c.success(e.message),n.reload()},okText:"确认",cancelText:"取消"},u.createElement(g,{size:"small",danger:!0},"删除"))]}],Ae=function(e){const[t,a]=u.useState({}),[n,l]=u.useState(!1);return u.useEffect((()=>{!async function(){const{data:t}=await async function(e){return ee.post("/v1/pay/qrcode/",e)}({packageName:e.packageName});(null==t?void 0:t.code)>0&&a(t.data)}()}),[n]),u.createElement("div",null,u.createElement(g,{onClick:()=>{l(!n)}},"刷新"),u.createElement("br",null),u.createElement("br",null),u.createElement(P,{src:t.qrcode}),u.createElement("br",null),u.createElement("br",null),u.createElement("pre",null,u.createElement("code",null,JSON.stringify(t,null,"\t"))))},Oe=function(e){const[t,a]=u.useState(!1);return u.createElement("div",null,u.createElement(S,{title:"编辑更新内容",centered:!0,keyboard:!1,visible:t,onOk:()=>a(!1),onCancel:()=>a(!1),width:"80%"},e.children),u.createElement(g,{onClick:()=>{a(!0)}},e.title))},{TabPane:Ve}=N,Be={path:"/dash/",component:function(){return u.createElement(v,{ghost:!0,header:{title:"Demo -- 支持Lonely"}},u.createElement(N,{defaultActiveKey:"1"},u.createElement(Te,{tab:"购买",key:"1"},u.createElement(fe,null)),u.createElement(Te,{tab:"客户端",key:"2"},u.createElement(Ce,null))))},exact:!0,routes:[{path:"/dash/profile",component:function(){var e;const t=u.useContext(re),[a,n]=u.useState(!1),l=u.useRef();return u.useEffect((()=>{!async function(){const{data:e}=await ae();(null==e?void 0:e.code)>0&&t.setUser(e.data)}()}),[a]),u.createElement(v,{ghost:!0,header:{title:"个人设置"}},u.createElement(A,{column:2},u.createElement(A.Item,{label:"用户名"},u.createElement(O,{text:t.user.username,valueType:"text",mode:"read",plain:!1}))),u.createElement("br",null),u.createElement(E,{formRef:l,submitter:{render:e=>[u.createElement(g,{onClick:()=>{var t;null==(t=e.form)||t.submit()}},"保存")]},onFinish:async e=>{const{data:t}=await async function(e){return ee.post("/v1/dashboard/admin/modify",e)}(e);(null==t?void 0:t.code)>0&&c.success(t.message),n(!a)}},u.createElement(E.Group,null,u.createElement(f,{initialValue:null==(e=t.user)?void 0:e.bilibiliUid,name:"bilibiliUid",label:"Bilibili Uid",width:"lg",placeholder:"请输入"})),u.createElement(E.Group,null,u.createElement(V,{initialValue:t.user.bilibiliCookie,name:"bilibiliCookie",label:"Bilibili Cookie",width:"lg",placeholder:"请输入"}))))},exact:!0},{name:"用户",icon:u.createElement(H,null),routes:[{path:"/dash/user/user-manager",name:"用户管理",component:function(){const e=u.useRef();return u.createElement(v,{ghost:!0,header:{title:"用户设置"}},u.createElement(w,{columns:ze,request:async e=>{var t,a,n;const{data:l}=await async function(e){return ee.post("/v1/dashboard/consumer/query",e)}(e);return{data:l.code>0?null==(t=l.data)?void 0:t.list:[],success:!0,total:null!=(n=null==(a=l.data)?void 0:a.total)?n:0}},expandable:{expandedRowRender:e=>u.createElement("pre",null,u.createElement("code",null,JSON.stringify(e,null,"\t")))},pagination:{showQuickJumper:!0,pageSize:20},actionRef:e,rowKey:e=>e.id,dateFormatter:"string",headerTitle:"应用列表",bordered:!0}))},exact:!0},{path:"/dash/user/payment-manager",name:"订单管理",component:function(){const e=u.useRef();return u.createElement(v,{ghost:!0,header:{title:"订单管理"}},u.createElement(w,{columns:Se,request:async e=>{var t,a,n;const{data:l}=await async function(e){return ee.post("/v1/pay/query",e)}(e);return{data:null!=(a=null==(t=l.data)?void 0:t.list)?a:[],success:!0,total:null==(n=l.data)?void 0:n.total}},expandable:{expandedRowRender:e=>u.createElement("pre",null,u.createElement("code",null,JSON.stringify(e,null,"\t")))},pagination:{showQuickJumper:!0,pageSize:20},actionRef:e,rowKey:"id",dateFormatter:"string",headerTitle:"应用列表",toolBarRender:()=>[],bordered:!0}))},exact:!0}]},{name:"应用",icon:u.createElement(M,null),routes:[{path:"/dash/app/app-manager",name:"应用管理",component:function(){const e=u.useRef();return u.createElement(v,{ghost:!0,header:{title:"应用设置"}},u.createElement(w,{columns:ue,search:!1,scroll:{x:1500},request:async()=>{var e;const{data:t}=await ne();return{data:null!=(e=t.data)?e:[],success:!0}},pagination:{showQuickJumper:!0},actionRef:e,rowKey:e=>e.id,dateFormatter:"string",headerTitle:"应用列表",toolBarRender:()=>[u.createElement(de,{title:"新建应用",onFinish:async t=>{var a;if(t.price<t.discount)return void c.error("折扣价大于价格");const{data:n}=await async function(e){return ee.post("/v1/goods/create",e)}(t);return n.code>0&&(c.success(n.message),null==(a=e.current)||a.reload(),!0)}})],bordered:!0}))},exact:!0}]},{name:"工具",icon:u.createElement(K,null),routes:[{path:"/dash/tool/app-update",name:"更新管理",component:function(){const e=u.useRef(),[t,a]=u.useState([]),[n,l]=u.useState(!0);return u.useEffect((()=>{!async function(){const{data:e}=await ne();l(!1),(null==e?void 0:e.data)&&a(e.data)}()}),[]),u.createElement(v,{ghost:!0,header:{title:"应用更新管理"}},!n&&0===(null==t?void 0:t.length)&&u.createElement(R,{subTitle:"请先创建商品"}),u.createElement(N,{defaultActiveKey:"1"},t.map(((t,a)=>u.createElement(ye,{tab:t.goodsName,key:String(a)},u.createElement(w,{columns:ge,search:!1,request:async e=>{var a,n,l;const{data:r}=await async function(e){return ee.post("/v1/tools/app_update/history",e)}(i({packageName:t.packageName},e));return{data:null!=(n=null==(a=r.data)?void 0:a.list)?n:[],success:!0,total:null==(l=r.data)?void 0:l.total}},pagination:{showQuickJumper:!0},actionRef:e,rowKey:e=>e.id,dateFormatter:"string",headerTitle:"应用列表",toolBarRender:()=>[u.createElement(he,{packageName:t.packageName,title:"添加更新",onFinish:async t=>{var a;const{data:n}=await async function(e){return ee.post("/v1/tools/app_update/add",e)}(t);return n.code>0&&(c.success(n.message),null==(a=e.current)||a.reload(),!0)}})],bordered:!0}))))))},exact:!0},{path:"/dash/tool/entry-notification",name:"初屏通知",component:function(){const e=u.useRef(),[t,a]=u.useState([]),[n,l]=u.useState(!0);return u.useEffect((()=>{!async function(){const{data:e}=await ne();l(!1),(null==e?void 0:e.data)&&a(e.data)}()}),[]),u.createElement(v,{ghost:!0,header:{title:"初屏通知管理"}},!n&&0===(null==t?void 0:t.length)&&u.createElement(R,{subTitle:"请先创建商品"}),u.createElement(N,{defaultActiveKey:"1"},t.map(((t,a)=>u.createElement(Fe,{tab:t.goodsName,key:String(a)},u.createElement(w,{columns:Ue,search:!1,request:async e=>{var a,n,l;const{data:r}=await async function(e){return ee.post("/v1/tools/splash_notification/history",e)}(i({packageName:t.packageName},e));return{data:null!=(n=null==(a=r.data)?void 0:a.list)?n:[],success:!0,total:null==(l=r.data)?void 0:l.total}},pagination:{showQuickJumper:!0},actionRef:e,rowKey:e=>e.id,dateFormatter:"string",headerTitle:"应用列表",toolBarRender:()=>[u.createElement(qe,{title:"添加通知",onFinish:async a=>{var n;const{data:l}=await async function(e){return ee.post("/v1/tools/splash_notification/add",e)}(i({packageName:t.packageName},a));return l.code>0&&(c.success(l.message),null==(n=e.current)||n.reload()),!0}})],bordered:!0}))))))},exact:!0},{path:"/dash/tool/tiny",name:"小工具",component:function(){const[e,t]=u.useState([]);return u.useEffect((()=>{!async function(){const{data:e}=await ne();(null==e?void 0:e.data)&&t(e.data)}()}),[]),u.createElement(v,{ghost:!0,header:{title:"小工具"}},u.createElement(g,{onClick:()=>{window.open("https://sentry.io/organizations")}},"打开Sentry")," ",u.createElement(g,{onClick:async()=>{const{data:e}=await async function(){return ee.post("/v1/tools/tiny_tool/bak_db")}();e.code>0&&c.success(e.message)}},"备份数据库")," ",u.createElement("br",null),u.createElement("br",null),u.createElement("br",null),u.createElement("i",null,"需要注册一个同管理员账号相同的的client用户"),u.createElement(N,{defaultActiveKey:"1"},e.map(((e,t)=>u.createElement(Ve,{tab:e.goodsName,key:String(t)},u.createElement(Oe,{title:"支付二维码"},u.createElement(Ae,{packageName:e.packageName})),u.createElement("br",null))))))},exact:!0}]}]},Le=[{path:"/login",component:function(){const e=m(),t=u.useContext(re);return u.createElement("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center"}},u.createElement(x,{style:{width:350},tabs:{type:"line"}},u.createElement(x.TabPane,{key:"login-tab",tab:"登录"},u.createElement(E,{onFinish:async a=>{const{data:n}=await async function(e){return ee.post("/v1/dashboard/admin/login_pwd",e)}(a);n.code>0&&(localStorage.setItem("t",n.data.auth),t.setUser(n.data),e.replace("/dash"))},submitter:{searchConfig:{submitText:"登录"},render:(e,t)=>t.pop(),submitButtonProps:{size:"large",style:{width:"100%"}}}},u.createElement(f,{fieldProps:{size:"large",prefix:u.createElement(C,null)},name:"username",placeholder:"邮箱",rules:[{required:!0,message:"请输入用户名!"},{pattern:/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,message:"不合法的用户名!"}]}),u.createElement("div",{style:{height:10}}),u.createElement(f.Password,{fieldProps:{size:"large",prefix:u.createElement(T,null)},name:"password",placeholder:"密码",rules:[{required:!0,message:"请输入密码"}]}),u.createElement("div",{style:{height:10}})),u.createElement(me,null))))},exact:!0},{path:"/dash",component:function(){const e=m(),t=u.useContext(re);return u.createElement(B,{key:"ProLayout",route:Be,fixedHeader:!0,menuItemRender:(t,a)=>u.createElement("a",{onClick:()=>{e.push(t.path||"/")}},a),headerContentRender:()=>[u.createElement(g,{key:"btn1",type:"link",onClick:()=>{e.replace("/dash")}},"主页")],rightContentRender:()=>u.createElement("div",null,u.createElement(L,{overlay:_e(),placement:"bottomLeft"},u.createElement(j,{style:{backgroundColor:"#1890ff"},shape:"circle"},oe.string(t.user.username)?t.user.username[0].toUpperCase():""))),navTheme:"light",title:"Lonely",logo:!1},u.createElement(D,null,Xe.map(((e,t)=>u.createElement(G,i({key:t},e))))))}},{path:"*",component:Re}],Xe=function(e){const t=[],a=function(e){const{routes:s}=e,i=((e,t)=>{var a={};for(var s in e)n.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&l)for(var s of l(e))t.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a})(e,["routes"]);if(e.path&&t.push(i),s)for(const t of s)a(t)};return a(e),t.push({path:"*",component:Re}),t}(Be),je=new Z,De=function(){return u.createElement("div",{id:"pro-layout",style:{height:"100vh"}},u.createElement(re.Provider,{value:le},u.createElement(Q,{client:je},u.createElement(W,null,u.createElement(se,null,u.createElement(D,null,Le.map(((e,t)=>u.createElement(G,i({key:t},e))))))))))};console.log=function(){},console.log({VITE_API:"https://lonely-mgmt-demo.deskbtm.com",VITE_PACKAGENAME:"com.deskbtm.lonely",VITE_PROD_API:"https://app-mgmt.deskbtm.com",BASE_URL:"/",MODE:"demo",DEV:!0,PROD:!1}),Y.render(u.createElement(De,null),document.getElementById("root"));
